(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[949],{11284:(e,t,s)=>{"use strict";s.d(t,{V:()=>r,p:()=>i});var n=s(95155),l=s(12115),a=s(37621);let o=(0,l.createContext)(void 0);function r(e){let{children:t}=e,[s,r]=(0,l.useState)({xp:0,level:1,streakDays:0,completedChapters:[],dailyXp:0,weeklyXp:0,totalLessons:0,completedLessons:0,canAccessAdvancedTopics:!1,earnedAdvancedAccess:!1,advancedUnlockXpRequired:1800,advancedUnlockLessonsRequired:12}),i=(0,l.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.level,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];{let a=new CustomEvent("xpGained",{detail:{amount:e,source:t,newXp:s.xp+e,newLevel:n,leveledUp:l}});window.dispatchEvent(a)}},[s.level,s.xp]),d=(0,l.useCallback)(async()=>{try{let e=await (0,a.n)("/users/me/dashboard");r({xp:e.xp,level:e.level,streakDays:e.streak_days,completedChapters:e.completed_lesson_ids.map(e=>e.toString()),dailyXp:e.daily_xp,weeklyXp:e.weekly_xp,totalLessons:e.total_lessons,completedLessons:e.completed_lessons,canAccessAdvancedTopics:e.can_access_advanced_topics,earnedAdvancedAccess:e.earned_advanced_access,advancedUnlockXpRequired:e.advanced_unlock_xp_required,advancedUnlockLessonsRequired:e.advanced_unlock_lessons_required})}catch(e){console.error("Failed to load progress:",e)}},[]);(0,l.useEffect)(()=>{d()},[d]);let c=(0,l.useCallback)(async(e,t)=>{i(e,t),await d()},[i,d]),u=(0,l.useCallback)(async(e,t)=>{if(s.completedChapters.includes(e))return;let n=Number(e);if(!Number.isInteger(n)||n<=0)return void console.error("Invalid lesson id for chapter completion: ".concat(e));try{var l,o,r,c;let e=await (0,a.n)("/progress/lessons/".concat(n,"/complete"),{method:"POST",body:JSON.stringify({quiz_score:null!=(l=null==t?void 0:t.quizScore)?l:100,challenge_passed:null==(o=null==t?void 0:t.challengePassed)||o,attempt_id:null!=(r=null==t?void 0:t.attemptId)?r:null,dwell_seconds:null!=(c=null==t?void 0:t.dwellSeconds)?c:0})});e.xp_awarded>0&&i(e.xp_awarded,"Completed lesson ".concat(n),e.level,e.level>s.level),await d()}catch(e){console.error("Failed to complete chapter:",e)}},[i,s.completedChapters,s.level,d]),p=(0,l.useCallback)(async()=>{await d()},[d]);return(0,n.jsx)(o.Provider,{value:{progress:s,addXP:c,completeChapter:u,updateStreak:p,refreshProgress:d},children:t})}function i(){let e=(0,l.useContext)(o);if(!e)throw Error("useProgress must be used within ProgressProvider");return e}},20092:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var n=s(95155),l=s(12115),a=s(52619),o=s.n(a),r=s(20063),i=s(99708),d=s(26497),c=s(33382),u=s(85921),p=s(90368),m=s(27937),h=s(25016),x=s(70856);function f(e){let{title:t,pages:s,onComplete:a}=e,[o,r]=(0,l.useState)(0),[i,f]=(0,l.useState)(0),g=s[o];return(0,n.jsxs)("div",{className:"relative flex min-h-[600px] w-full max-w-4xl flex-col overflow-hidden rounded-xl bg-[#fdfbf7] shadow-2xl perspective-1000",children:[(0,n.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 z-20 bg-gradient-to-r from-red-800 to-red-600 flex flex-col items-center justify-center gap-8 shadow-inner",children:(0,n.jsx)("div",{className:"w-1 h-full border-r border-black/10"})}),(0,n.jsxs)("header",{className:"absolute top-0 left-12 right-0 z-10 flex h-16 items-center justify-between border-b border-[#e5e5e5] bg-[#fdfbf7] px-8",children:[(0,n.jsx)("h2",{className:"font-handwriting text-2xl font-bold text-slate-800",children:t}),(0,n.jsxs)("span",{className:"font-mono text-sm text-slate-500",children:["Page ",o+1," of ",s.length]})]}),(0,n.jsxs)("div",{className:"relative flex-1 bg-[#fdfbf7] ml-12 p-8 pt-24",children:[(0,n.jsx)("div",{className:"absolute inset-0 pointer-events-none bg-notebook-lines opacity-50"}),(0,n.jsx)("div",{className:"absolute top-0 bottom-0 left-20 w-px bg-red-300/50"}),(0,n.jsx)(d.N,{initial:!1,custom:i,mode:"wait",children:(0,n.jsxs)(c.P.div,{custom:i,variants:{enter:e=>({x:e>0?1e3:-1e3,opacity:0,rotateY:e>0?90:-90}),center:{zIndex:1,x:0,opacity:1,rotateY:0},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0,rotateY:e<0?90:-90})},initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2},rotateY:{duration:.4}},className:"relative z-0 h-full w-full pl-16 pr-4",children:["text"===g.type&&(0,n.jsx)("div",{className:"prose prose-slate max-w-none prose-headings:font-handwriting prose-headings:text-slate-900 prose-p:text-slate-900 prose-li:text-slate-900 prose-ul:text-slate-900 prose-ol:text-slate-900 prose-strong:text-slate-900 prose-code:text-slate-900 prose-ul:list-disc prose-ul:ml-6 prose-ol:list-decimal prose-ol:ml-6 prose-li:ml-2 font-handwriting text-lg leading-loose text-slate-900",children:(0,n.jsx)(x.oz,{children:g.content})}),"code"===g.type&&(0,n.jsxs)("div",{className:"not-prose my-6 rounded-lg bg-[#1e1e1e] p-4 font-mono text-sm text-white shadow-lg border border-slate-200 transform rotate-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-white/10 pb-2 mb-2",children:[(0,n.jsx)("span",{className:"text-xs text-slate-400",children:"main.py"}),(0,n.jsx)(u.A,{size:14,className:"text-green-400 hover:text-green-300 cursor-pointer"})]}),(0,n.jsx)("pre",{className:"whitespace-pre-wrap",children:g.content})]}),"diagram"===g.type&&(0,n.jsx)("div",{className:"my-8 flex justify-center rounded-xl border-2 border-dashed border-slate-300 bg-white p-8",children:(0,n.jsx)("p",{className:"font-handwriting text-xl text-slate-500",children:g.content})})]},o)})]}),(0,n.jsxs)("div",{className:"absolute bottom-0 left-12 right-0 z-10 flex h-20 items-center justify-between bg-gradient-to-t from-[#fdfbf7] to-transparent px-8",children:[(0,n.jsxs)("button",{onClick:()=>{o>0&&(f(-1),r(e=>e-1))},disabled:0===o,className:(0,h.cn)("flex items-center gap-2 rounded-lg px-4 py-2 font-handwriting text-lg font-bold text-slate-700 transition-colors hover:bg-black/5 disabled:opacity-50",0===o&&"cursor-not-allowed"),children:[(0,n.jsx)(p.A,{size:20}),"Previous"]}),(0,n.jsxs)("button",{onClick:()=>{o<s.length-1?(f(1),r(e=>e+1)):a()},className:"flex items-center gap-2 rounded-lg bg-slate-800 px-6 py-2 font-handwriting text-lg font-bold text-white transition-colors hover:bg-slate-700 shadow-md",children:[o===s.length-1?"Finish":"Next Page",(0,n.jsx)(m.A,{size:20})]})]})]})}var g=s(11284),v=s(37621),b=s(59299);function y(e){let{params:t}=e,s=(0,l.use)(t),a=(0,r.useRouter)(),{completeChapter:d}=(0,g.p)(),[c,u]=(0,l.useState)([]),[p,m]=(0,l.useState)(1800),[h,x]=(0,l.useState)(12),[y,w]=(0,l.useState)(null),[_,j]=(0,l.useState)(()=>Date.now()),[N,k]=(0,l.useState)(!0),[S,C]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{k(!0),C(null);let[t,s,n]=await Promise.all([(0,v.n)("/courses/catalog"),(0,v.n)("/users/me/dashboard"),(0,v.n)("/learning/gates")]);if(!e)return;let l=Object.fromEntries(n.map(e=>[e.module_id,e]));u((0,b.$)(t,s.completed_lesson_ids,s.can_access_advanced_topics,l)),m(s.advanced_unlock_xp_required),x(s.advanced_unlock_lessons_required)}catch(t){if(!e)return;C(t instanceof Error?t.message:"Unable to load this lesson.")}finally{e&&k(!1)}})(),()=>{e=!1}},[]);let A=c.find(e=>e.id===s.category),P=null==A?void 0:A.chaptersList.find(e=>e.id===s.chapter),z=(0,l.useMemo)(()=>P?(0,b.D)(P.contentMd,P.objective,P.starterCode):[],[P]);(0,l.useEffect)(()=>{if(!P||P.locked)return;let e=!1;return(async()=>{try{w(null);let t=await (0,v.n)("/learning/lessons/".concat(P.lessonId,"/attempts/start"),{method:"POST",body:JSON.stringify({dwell_seconds:0,metadata_json:{category:s.category,chapter:s.chapter}})});e||(w(t.attempt_id),j(Date.now()))}catch(e){}})(),()=>{e=!0}},[P,s.category,s.chapter]),(0,l.useEffect)(()=>{if(!P||P.locked||!y)return;let e=!1,t=async t=>{if(e)return;let s=Math.max(0,Math.floor((Date.now()-_)/1e3));try{await (0,v.n)("/learning/lessons/".concat(P.lessonId,"/attempts/heartbeat"),{method:"POST",body:JSON.stringify({attempt_id:y,dwell_seconds:s,metadata_json:{reason:t,visibility:document.visibilityState,chapter_id:P.id}})})}catch(e){}},s=window.setInterval(()=>{"visible"===document.visibilityState&&t("interval")},15e3),n=()=>{"hidden"===document.visibilityState&&t("visibility")};return document.addEventListener("visibilitychange",n),()=>{window.clearInterval(s),document.removeEventListener("visibilitychange",n),t("final"),e=!0}},[y,P,_]);let L=async()=>{if(!P)return;let e=Math.max(0,Math.floor((Date.now()-_)/1e3));if(y)try{await (0,v.n)("/learning/lessons/".concat(P.lessonId,"/attempts/heartbeat"),{method:"POST",body:JSON.stringify({attempt_id:y,dwell_seconds:e,metadata_json:{reason:"final",visibility:document.visibilityState,chapter_id:P.id}})})}catch(e){}await d(P.id,{attemptId:null!=y?y:void 0,dwellSeconds:e,quizScore:100,challengePassed:!0}),a.push("/learn/".concat(s.category))};return N?(0,n.jsx)("div",{className:"flex min-h-[calc(100vh-100px)] items-center justify-center p-4 md:p-8 animate-floatUp",children:(0,n.jsx)("div",{className:"h-[600px] w-full max-w-4xl rounded-xl border border-white/10 bg-white/5 animate-pulse"})}):S?(0,n.jsxs)("div",{className:"rounded-2xl border border-red-500/30 bg-red-500/10 p-6 text-red-200",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Could not load this lesson"}),(0,n.jsx)("p",{className:"mt-2 text-sm",children:S})]}):A&&P?P.locked?(0,n.jsxs)("div",{className:"mx-auto max-w-2xl animate-floatUp rounded-2xl border border-red-500/30 bg-red-500/10 p-8 text-red-100",children:[(0,n.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full bg-red-500/20 px-3 py-1 text-xs font-semibold uppercase tracking-wide",children:[(0,n.jsx)(i.A,{size:14}),"Advanced lesson locked"]}),(0,n.jsx)("h1",{className:"mt-4 text-2xl font-bold text-white",children:P.title}),(0,n.jsx)("p",{className:"mt-3 text-sm text-red-100",children:"Mastery gate lock"===P.lockReason?"Unlock this lesson by completing the previous module with quiz score >= 70 and passed challenges.":"Unlock this lesson with an active subscription or by earning ".concat(p," XP / ").concat(h," completed lessons.")}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,n.jsx)(o(),{href:"/subscription",className:"rounded-lg bg-white px-4 py-2 text-sm font-semibold text-slate-900 transition-colors hover:bg-slate-100",children:"View Subscription"}),(0,n.jsx)(o(),{href:"/learn/".concat(A.id),className:"rounded-lg border border-white/40 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-white/10",children:"Continue Free Lessons"})]})]}):(0,n.jsx)("div",{className:"flex min-h-[calc(100vh-100px)] items-center justify-center p-4 md:p-8 animate-floatUp",children:(0,n.jsx)(f,{title:P.title,pages:z,onComplete:L})}):(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 text-slate-300",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Lesson not found"}),(0,n.jsx)("p",{className:"mt-2 text-sm",children:"This lesson does not exist in the current catalog."}),(0,n.jsx)(o(),{href:"/learn",className:"mt-4 inline-flex text-sm font-semibold text-blue-300 hover:text-blue-200",children:"Back to Learning Paths"})]})}},21864:(e,t,s)=>{Promise.resolve().then(s.bind(s,20092))},25016:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var n=s(2821),l=s(75889);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,n.$)(t))}},37621:(e,t,s)=>{"use strict";s.d(t,{n:()=>d});var n,l=s(68209);let a=null==(n=s(95704).env.NEXT_PUBLIC_API_URL)?void 0:n.trim(),o=a&&a.length>0?a:"/api",r="/api";async function i(e){if((e.headers.get("content-type")||"").includes("application/json")){let t=await e.json().catch(()=>null);if(t&&"string"==typeof t.detail)return t.detail;if(t&&Array.isArray(t.detail))return t.detail.map(e=>null==e?void 0:e.msg).filter(Boolean).join(", ")}return await e.text()||"Request failed with status ".concat(e.status)}async function d(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=new Headers(s.headers||{}),d=void 0!==s.body,c="undefined"!=typeof FormData&&s.body instanceof FormData;if(!d||c||a.has("Content-Type")||a.set("Content-Type","application/json"),n){let e=(0,l.gf)();e&&a.set("Authorization","Bearer ".concat(e))}let u=e.startsWith("/")?e:"/".concat(e);async function p(e){return fetch("".concat(e).concat(u),{...s,headers:a,credentials:"include"})}try{t=await p(o)}catch(e){if(o!==r)t=await p(r);else throw e}if(!t.ok)throw Error(await i(t));return t.json()}},59299:(e,t,s)=>{"use strict";s.d(t,{$:()=>r,D:()=>i});let n=["from-green-400 to-emerald-600","from-cyan-400 to-blue-600","from-indigo-400 to-violet-600","from-orange-400 to-amber-600","from-rose-400 to-red-600","from-fuchsia-400 to-pink-600","from-lime-400 to-green-600","from-sky-400 to-indigo-600"],l=["advanced","internals","metaclass","concurrency","async","decorator","generator","profiling","optimization"];function a(e){return e.trim().toLowerCase()}function o(e){let t=a(e.title);return!!l.some(e=>t.includes(e))||e.xp_reward>=220}function r(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=new Set(t),d=[],c=0;for(let t of[...e].sort((e,t)=>e.order_index-t.order_index))for(let e of[...t.modules].sort((e,t)=>e.order_index-t.order_index)){let t=o(e),u=r[e.id],p=t&&!s,m=!!u&&!u.unlocked,h=p||m,x=null;p?x="Advanced module lock":m&&(x="Mastery gate lock");let f=[...e.lessons].sort((e,t)=>e.order_index-t.order_index).map(t=>{let n=function(e,t){if(o(e))return!0;let s=a(t.title);return!!l.some(e=>s.includes(e))||t.coding_challenges.some(e=>"hard"===a(e.difficulty))}(e,t),r=n&&!s,d=h||r,c=r?"Advanced lesson lock":x;return{id:t.id.toString(),lessonId:t.id,title:t.title,objective:t.objective,estimatedMinutes:t.estimated_minutes,xpReward:function(e){let t=e.coding_challenges.reduce((e,t)=>Math.max(e,t.xp_reward),0);return t>0?t:60}(t),completed:i.has(t.id),isAdvanced:n,locked:d,lockReason:c,contentMd:t.content_md,starterCode:function(e){let t=e.coding_challenges[0];return t&&t.starter_code?t.starter_code:null}(t)}}),g=f.filter(e=>e.completed).length,v=f.length,b=v>0?Math.round(g/v*100):0;d.push({id:e.id.toString(),title:e.title,description:e.description,color:n[c%n.length],chapters:v,completedLessons:g,progressPercent:b,isAdvanced:t,locked:h,lockReason:x,chaptersList:f}),c+=1}return d}function i(e,t,s){var n,l,a;let o=[],r=null!=(n=null==e?void 0:e.trim())?n:"",i=/```([a-zA-Z0-9_+-]*)\n([\s\S]*?)```/g,d=0,c=i.exec(r);for(;c;){let e=r.slice(d,c.index).trim();e&&o.push({type:"text",content:e});let t=(null==(l=c[1])?void 0:l.trim())||"python",s=null==(a=c[2])?void 0:a.trim();s&&o.push({type:"code",language:t,content:s}),d=c.index+c[0].length,c=i.exec(r)}let u=r.slice(d).trim();return(u&&o.push({type:"text",content:u}),(null==s?void 0:s.trim())&&o.push({type:"code",language:"python",content:s.trim()}),t.trim()&&o.push({type:"text",content:"## Lesson Goal\n".concat(t)}),0===o.length)?[{type:"text",content:"# Lesson\nThis lesson content is not available yet."}]:o}},68209:(e,t,s)=>{"use strict";s.d(t,{TV:()=>l,Ti:()=>o,gf:()=>a});let n="pypilot_user";function l(e){localStorage.removeItem("pypilot_access_token"),localStorage.setItem(n,JSON.stringify(e))}function a(){return null}function o(){let e=localStorage.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}}},e=>{e.O(0,[164,619,86,344,441,255,358],()=>e(e.s=21864)),_N_E=e.O()}]);